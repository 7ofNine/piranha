SET(PYRANHA_INSTALL_PATH ${PYTHON_MODULES_PATH}/pyranha)

MACRO(PYTHONCMOD arg1)
  SET_TARGET_PROPERTIES(${arg1} PROPERTIES PREFIX "")
  IF(PYDEXTENSION)
    SET_TARGET_PROPERTIES(${arg1} PROPERTIES SUFFIX ".pyd")
  ENDIF(PYDEXTENSION)
  TARGET_LINK_LIBRARIES(${arg1} ${MANDATORY_LIBRARIES} ${PYTHON_LIBRARIES} ${BOOST_PYTHON_LIBRARY} ${ARGN})
  STRING(REGEX REPLACE "^_" "" DIR_ARG ${arg1})
  INSTALL(TARGETS ${arg1}
    RUNTIME DESTINATION ${PYRANHA_INSTALL_PATH}/${DIR_ARG}
    LIBRARY DESTINATION ${PYRANHA_INSTALL_PATH}/${DIR_ARG}
  )
  SET(MODULE_NAME ${arg1})
  CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/../__init__.py.template
    ${CMAKE_CURRENT_SOURCE_DIR}/__init__.py)
  INSTALL(FILES __init__.py DESTINATION ${PYRANHA_INSTALL_PATH}/${DIR_ARG})
ENDMACRO(PYTHONCMOD)

# Mandatory targets
SET(MODULE_LIST \ \"Core\",\ )
ADD_SUBDIRECTORY(Core)

# Optional targets
IF(BUILD_PYRANHA_FS)
  SET(MODULE_LIST ${MODULE_LIST}"Fs",\ )
  ADD_SUBDIRECTORY(Fs)
  SET(MODULE_LIST ${MODULE_LIST}"Fsc",\ )
  ADD_SUBDIRECTORY(Fsc)
ENDIF(BUILD_PYRANHA_FS)

IF(BUILD_PYRANHA_MPFS)
  SET(MODULE_LIST ${MODULE_LIST}"Mpfs",\ )
  ADD_SUBDIRECTORY(Mpfs)
  SET(MODULE_LIST ${MODULE_LIST}"Mpfsc, ")
  ADD_SUBDIRECTORY(Mpfsc)
ENDIF(BUILD_PYRANHA_MPFS)

IF(BUILD_PYRANHA_CFS)
  SET(MODULE_LIST ${MODULE_LIST}"Cfs",\ )
  ADD_SUBDIRECTORY(Cfs)
  SET(MODULE_LIST ${MODULE_LIST}"Cfsc",\ )
  ADD_SUBDIRECTORY(Cfsc)
ENDIF(BUILD_PYRANHA_CFS)

IF(BUILD_PYRANHA_SP)
  ADD_SUBDIRECTORY(Sp)
#  ADD_SUBDIRECTORY(Spc)
ENDIF(BUILD_PYRANHA_SP)

IF(BUILD_PYRANHA_GUI)
  SET(MODULE_LIST ${MODULE_LIST}"Gui",\ )
  ADD_SUBDIRECTORY(Gui)
ENDIF(BUILD_PYRANHA_GUI)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/__init__.py.global
  ${CMAKE_CURRENT_SOURCE_DIR}/__init__.py)

INSTALL(FILES __init__.py DESTINATION ${PYRANHA_INSTALL_PATH})
